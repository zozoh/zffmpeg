数据包的序列化与反序列化
====================

## 关于 TLD 数据类型

数据将统统被序列化成统一的 **TLD** 的紧凑二进制格式。 
所谓 **TLD** 即 *Tag-Length-Data* 形式的二进制数据流。

一个数据流，第一个字节(uint8) 即表示的是 Tag。
之后的 2 个字节表示一个整数，为之后数据的长度

      V------- 第一个字节表示 TAG，第二个字节用作对齐，为 00
    |<--->|
     E0 00 C9 12 87 2D ...
           |<------->|
               | 
           4 个字节表示长度，可以用一个 uint16 来表示它

根据这个格式， TLD 的 **"D"** 当然也可以包含嵌套一个或多个TLD，从而形成嵌套

## TAG 的类型

  N | Comment
----|-----------------------
 E0 | 表示数据为一个 AVCodecContext
 F0 | 表示数据为一个 AVPacket 结构

## AVCodecContext 的序列化

对与 *E0* 的数据，它的 Data 段结构为:

    E1              (表示 AVCodecContext 的数据)
    00              (空一个字节来对齐）
    00 00 9C 8A     (四个字节表示后面的长度)
    AE C3 90 .. 8A 5E C1 ... (表示数据，这个可以直接 memcpy 为 AVCodecContext)
    #----------------------------------------------------------------------
    # 接着判断一下数据是否超出了 E0 的 data 段长度
    # 如果没有超出怎根据读取的 TAG 来判断要修改 AVCodecContext 哪个字段
    # 之后的 TAG 有如下可能（统统 memcpy就好）:
    #----------------------------------------------------------------------
    E2    # rc_eq        : char *       : 长度为字符串长度+1容纳 \0
    #----------------------------------------------------------------------
    E3    # extradata    : uint8_t *    : 必须长度是 extradata_size
    #----------------------------------------------------------------------
    E4    # intra_matrix : uint16_t *   : 必须长度是 64
    #----------------------------------------------------------------------
    E5    # inter_matrix : uint16_t *   : 必须长度是 64
    #----------------------------------------------------------------------
    E6    # rc_override  : RcOverride * : 必须长度是 
          #                         rc_override_count * sizeof(RcOverride)



## AVPacket 的序列化

> 为了实现上的便利，我们将丢掉 *side_data* 相关的信息

对与 *F0* 的数据，它的 Data 段结构为:

    F1              (表示 AVPacket 的数据)
    00              (空一个字节来对齐）
    00 00 9C 8A     (四个字节表示后面的长度)
    AE C3 90 .. 8A 5E C1 ... (表示数据，这个可以直接 memcpy 为 AVPacket)
    #----------------------------------------------------------------------
    F2    # data  : uint8_t *    : 必须长度是 size (这个是最多的数据)
    




















